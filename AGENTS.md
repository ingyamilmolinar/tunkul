# Project Guidelines

- Use Go 1.23.x as specified in `go.mod`.
 - **Run the unit tests before opening a PR.** Use the stubbed Ebiten API via
   `go test -tags test -modfile=go.test.mod ./...` for maximum portability.
   If your system has a working X11 environment you may instead execute
   `xvfb-run go test ./...` to test against the real Ebiten library.
- Build the WebAssembly binary using `make all` from the repo root. This command
  runs `go mod download` before compiling, so the first build requires network
  access.
- The `src/js/main.wasm` file is generated by `make`; avoid committing changes to it.
- UI code resides under `src/go/internal/ui`. The test suite can run either
  against a stubbed Ebiten (`go.test.mod`) or the real library.
- For native builds using the real Ebiten library, run `scripts/setup-ebiten-env.sh` to install the necessary system packages (Homebrew or apt).
- Building with the real Ebiten module requires network access on the first run
  so Go can download dependencies. If networking is disabled, use the stubbed
  modules or ensure all packages are vendored.

### Headless X11
Install `xvfb` and run the game via `xvfb-run` on systems without a display:

```sh
sudo apt-get install -y xvfb
xvfb-run go run ./cmd/tunkul.go
```
The virtual framebuffer lets Ebiten create a window while logs are printed to the console.

## Project Overview

Tunkul is a grid-based beat sequencer written in Go with Ebiten. The program renders a node graph where each node represents a drum hit. A bottom drum-machine panel shows the active steps. The scheduler in `core/beat` triggers beats at a configurable BPM using the pure data structures from `core/model`. The UI layer translates mouse and keyboard input into model operations and draws the results with Ebiten.

Key technologies:
- Go 1.23
- Ebiten for cross-platform rendering (stubbed for headless tests)
- WASM build via `make all`

Code structure:
- `core/model` – pure graph and drum row logic (unit tested)
- `core/beat` – beat scheduler (integration tested)
- `internal/ui` – controller and renderer using Ebiten

